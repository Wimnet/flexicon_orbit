This is the GNU Radio package containing out-of-tree (OOT) modules to enable full-duplex (FD) wireless with our integrated FD radios. In this README we will describe each available OOT module and how it is used. 

To use the fullduplex blocks, the Python namespaces is in 'fullduplex', which is imported as:

    import fullduplex

See the Doxygen documentation for details about the blocks available in this package. A quick listing of the details can be found in Python after importing by using:

    help(fullduplex)
    
While the code is particular for our setup, we encourage other experimenters to modify it as necessary for their experiments. If you use this code, we would appreciate citations to  the following papers:

*Manav Kohli, Tingjun Chen, Mahmood Baraani Dastjerdi, Jackson Welles, Ivan Seskar, Harish Krishnaswamy, and Gil Zussman, "Open-Access Full-Duplex Wireless in the ORBIT and COSMOS Testbeds," in Proc. ACM MobiCom'20 Workshop on Wireless Network Testbeds, Experimental evaluation & CHaracterization (WiNTECH '20) (invited paper), Sept. 2020.* [[download](https://wimnet.ee.columbia.edu/wp-content/uploads/2020/08/wintech2020_orbit_cosmos_fullduplex_integration.pdf)]

*Tingjun Chen, Mahmood Baraani Dastjerdi, Jin Zhou, Harish Krishnaswamy, and Gil Zussman, “Wideband Full-Duplex Wireless via Frequency-Domain Equalization: Design and Experimentation,” in Proc. ACM MobiCom'19, Oct. 2019.* [[download](https://wimnet.ee.columbia.edu/wp-content/uploads/2018/12/FDE_MobiCom19.pdf)]

### FD Packet Encap2 
This block packetizes OFDM symbols generated by the OFDM Transmitter block from the gr-digital library. The input is a complex stream, and the output is a complex stream, with each OFDM packet separated by a specified number of zero samples before and after. The following parameters are used:

* **Debug**: If set to `Enable`, outputs debug information to the GNU Radio console.
* **Delay**: Always set to `Disable`.
* **Delay Sec**: Unused, can be set to any value
* **Pad Front**: defines the length of the zero padding before the OFDM packet starts. The greater this value, the lower the effective packet rate.
* **Pad Tail**: defines the length of the zero padding after the OFDM packet ends.
* **Pad Pos**: defines the position of additional OFDM symbols used for self-interference (SI) channel estimation in the Digital SIC block. Accepts value 0 or 1. 
* **Premultiplier**: Used for digital gain. Normally set to `1`.
* **Sync Word**: This determines which OFDM symbols to use for the SI channel estimation. `0` adds zero padding instead of a symbol, `1` adds sync word 1 used by the OFDM transmitter, `2` adds sync word 2 used by the OFDM transmitter, `3` utilizes the long training sequence (LTS) as used by 802.11.

The padding can be modified, but it is very important that the values used are consistent throughout the flowgraph. The same is true for the Pad Pos parameter.

### Digital SIC
This block accepts two complex valued inputs representing packetized data with a particular format and is designed to be used with the FD Packet Encap2 block. The top input is the transmitted data, and the bottom input is the received data.

The parameters available in this block are described below:
* **Debug**: If set to `True`, outputs debug information to the GNU Radio console.
* **Delay Tx2Rx**: defines the delay of the Rx samples with respect to the Tx samples. The optimal value is dependent on the bandwidth. With a bandwidth of 10 MHz, `40` should be used.
* **Pad Front**: defines the length of the zero padding before the OFDM packet starts. Must match the value defined in FD Packet Encap2.
* **Sig Pilot Pos**: defines the position of the extra OFDM pilot sybols used for channel estimation. Must match the value "Pad Pos" defined in FD Packet Encap2.
* **Frame Length**: defines how long the OFDM packet is, in samples.
* **SI channel k**: The single-sided width of the finite impulse response (FIR) filter used for digital SIC. `k = 10` is generally sufficient, which leads to `10*2 + 1 = 21` taps.
* **SI channel dim**: The dimension of the FIR. Generally, a single-dimension filter is sufficient, and `1` can be used.
* **Premultiplier**: Used for digital gain. Is normally set to `1`.

The three outputs are as follows:
* **Top**: The OFDM packets without digital SIC.
* **Middle**: The OFDM packets after digital SIC.
* **Bottom**: The digital SIC filter taps. 
